scikit-learn version 1.8.0 is not supported. Minimum required version: 0.17. Maximum required version: 1.5.1. Disabling scikit-learn conversion API.
Torch version 2.9.1+cu128 has not been tested with coremltools. You may run into unexpected errors. Torch 2.7.0 is the most recent version that has been tested.
Failed to load _MLModelProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLCPUComputeDeviceProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLGPUComputeDeviceProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLNeuralEngineComputeDeviceProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLModelProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLComputePlanProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLModelProxy: No module named 'coremltools.libcoremlpython'
Failed to load _MLModelAssetProxy: No module named 'coremltools.libcoremlpython'
/mnt/AIWorkSpace/work/TEST_DFINE_COUNT/D-FINE-master/src/zoo/dfine/dfine_decoder.py:765: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
  if memory.shape[0] > 1:
/mnt/AIWorkSpace/work/TEST_DFINE_COUNT/D-FINE-master/src/zoo/dfine/dfine_decoder.py:149: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
  if reference_points.shape[-1] == 2:
/mnt/AIWorkSpace/work/TEST_DFINE_COUNT/D-FINE-master/src/zoo/dfine/dfine_decoder.py:156: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can't record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!
  elif reference_points.shape[-1] == 4:
Tracing model...
Tracing complete.
Converting to Core ML...
Converting PyTorch Frontend ==> MIL Ops:   0%|          | 0/4927 [00:00<?, ? ops/s]Converting PyTorch Frontend ==> MIL Ops:  17%|█▋        | 830/4927 [00:00<00:00, 8285.76 ops/s]Converting PyTorch Frontend ==> MIL Ops:  34%|███▎      | 1659/4927 [00:00<00:00, 4880.66 ops/s]Converting PyTorch Frontend ==> MIL Ops:  50%|█████     | 2465/4927 [00:00<00:00, 5929.97 ops/s]Converting PyTorch Frontend ==> MIL Ops:  64%|██████▎   | 3140/4927 [00:00<00:00, 6180.54 ops/s]

ERROR - converting 'linear' op (located at: 'model/decoder/decoder/INSTANCE_NAME_UNKNOWN/5361'):

Converting PyTorch Frontend ==> MIL Ops:  74%|███████▍  | 3669/4927 [00:00<00:00, 6153.00 ops/s]
Traceback (most recent call last):
  File "/mnt/AIWorkSpace/work/TEST_DFINE_COUNT/scripts/convert_dfine_to_coreml.py", line 104, in <module>
    main(args.config, args.resume, args.output)
  File "/mnt/AIWorkSpace/work/TEST_DFINE_COUNT/scripts/convert_dfine_to_coreml.py", line 85, in main
    mlmodel = ct.convert(
              ^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/_converters_entry.py", line 646, in convert
    mlmodel = mil_convert(
              ^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/converter.py", line 186, in mil_convert
    return _mil_convert(
           ^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/converter.py", line 218, in _mil_convert
    proto, mil_program = mil_convert_to_proto(
                         ^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/converter.py", line 294, in mil_convert_to_proto
    prog = frontend_converter(model, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/converter.py", line 106, in __call__
    return load(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/load.py", line 87, in load
    return _perform_torch_convert(converter, debug)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/load.py", line 150, in _perform_torch_convert
    prog = converter.convert()
           ^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/converter.py", line 1392, in convert
    convert_nodes(self.context, self.graph, early_exit=not has_states)
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/ops.py", line 118, in convert_nodes
    raise e     # re-raise exception
    ^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/ops.py", line 113, in convert_nodes
    convert_single_node(context, node)
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/ops.py", line 174, in convert_single_node
    add_op(context, node)
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/ops.py", line 1196, in linear
    res = _create_linear_layer(x, W, bias)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/frontend/torch/ops.py", line 367, in _create_linear_layer
    return mb.linear(x=x, weight=w, bias=bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/mil/ops/registry.py", line 183, in add_op
    return cls._add_op(op_cls_to_add, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/mil/builder.py", line 237, in _add_op
    new_op.type_value_inference()
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/mil/operation.py", line 262, in type_value_inference
    output_types = self.type_inference()
                   ^^^^^^^^^^^^^^^^^^^^^
  File "/home/skchen/venv/deim/lib/python3.11/site-packages/coremltools/converters/mil/mil/ops/defs/iOS15/linear.py", line 70, in type_inference
    assert len(weight_shape) == 2
           ^^^^^^^^^^^^^^^^^^^^^^
AssertionError
